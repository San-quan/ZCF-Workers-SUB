; CF-Workers-BackCN-Adapted.ini - 2025 适配 cmliu/CF-Workers-SUB 的海外回国模板（合并 Cloudflare-BackCN + ACL4SSR_BackCN_HK 优点）
; 说明: 结合两份模板的优点：更丰富的国内 app 规则、IPv6 与 DNS 分流、AdBlock 强化、Proxy-Provider 订阅与 url-test 延迟测试
; 使用: 将此 INI 交给 Subconverter（或 CF-Workers-SUB 的后端）生成 Clash YAML。替换 ${...} 占位符为真实值或在 Workers 逻辑中注入。

[general]
loglevel = info
append = false
skip-missed = true
tproxy = true
error-report = true
log-file = /tmp/subconverter.log

[rule_provider]
geoip-cn = type: http, behavior: classical, url: "https://raw.githubusercontent.com/Loyalsoldier/geoip/release/CN.txt", path: ./ruleset/geoip-cn.yaml, interval: 43200
geoip-cn-v6 = type: http, behavior: classical, url: "https://raw.githubusercontent.com/Loyalsoldier/geoip/release/CN_v6.txt", path: ./ruleset/geoip-cn-v6.yaml, interval: 43200
geosite-cn = type: http, behavior: classical, url: "https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/geosite-cn.dat", path: ./ruleset/geosite-cn.yaml, interval: 43200

alibaba = type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Alibaba.list", path: ./ruleset/alibaba.yaml, interval: 43200
jd = type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/JD.list", path: ./ruleset/jd.yaml, interval: 43200
alipay = type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Alipay.list", path: ./ruleset/alipay.yaml, interval: 43200
tencent = type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Tencent.list", path: ./ruleset/tencent.yaml, interval: 43200
bilibili = type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Bilibili.list", path: ./ruleset/bilibili.yaml, interval: 43200
douyin = type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Douyin.list", path: ./ruleset/douyin.yaml, interval: 43200
meituan = type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Meituan.list", path: ./ruleset/meituan.yaml, interval: 43200
didi = type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/DiDi.list", path: ./ruleset/didi.yaml, interval: 43200
baidu = type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Baidu.list", path: ./ruleset/baidu.yaml, interval: 43200

lan = type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Lan.list", path: ./ruleset/lan.yaml, interval: 43200
banad = type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanAD.list", path: ./ruleset/banad.yaml, interval: 43200
adblock_reject = type: http, behavior: domain, url: "https://raw.githubusercontent.com/REIJI007/AdBlock_Rule_For_Clash/main/adblock_reject.yaml", path: ./ruleset/adblock_reject.yaml, interval: 1200
gfw = type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/GreatFire.list", path: ./ruleset/gfw.yaml, interval: 43200

[template]
clash-config = |
  mixed-port: 7890
  allow-lan: true
  mode: rule
  log-level: debug
  external-controller: 0.0.0.0:9090
  secret: ""
  ipv6: true

proxy-providers = |
  backcn_subscription:
    type: http
    url: "${backcn_sub_url}"      # 用于“回国/国内”订阅（可 base64）
    interval: 3600
    health-check:
      enable: true
      url: "http://www.gstatic.com/generate_204"
      interval: 300
  overseas_subscription:
    type: http
    url: "${overseas_sub_url}"    # 用于“海外/香港/其他”订阅
    interval: 3600
    health-check:
      enable: true
      url: "http://www.gstatic.com/generate_204"
      interval: 300

proxies = |
  # 示例（订阅通常会覆盖这些示例条目）
  - name: CN-Fallback
    type: ss
    server: ${CN_SERVER}
    port: ${CN_PORT}
    cipher: ${CN_ENCRYPTION}
    password: ${CN_PASSWORD}
    udp: true
    ipv6: true
  - name: HK-Fast
    type: vmess
    server: ${HK_SERVER}
    port: ${HK_PORT}
    uuid: ${HK_UUID}
    alterId: 0
    cipher: auto
    tls: true
    network: ws
    ws-path: /ws
    ws-headers:
      Host: ${HK_HOST}
    udp: true
    ipv6: true

proxy-groups = |
  - name: BackCN-Group
    type: url-test
    proxies:
      - backcn_subscription
      - CN-Fallback
      - HK-Fast
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    tolerance: 80
  - name: Overseas-Group
    type: url-test
    proxies:
      - overseas_subscription
      - HK-Fast
      - CN-Fallback
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    tolerance: 80

dns = |
  enable: true
  ipv6: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  nameserver:
    - 114.114.114.114
    - 223.5.5.5
  fallback:
    - https://dns.cloudflare.com/dns-query
    - https://doh.360.cn/dns-query
    - https://dns.google/dns-query
  fallback-filter:
    geoip: false
    ipcidr:
      - 240.0.0.0/4
  default-nameserver:
    - 114.114.114.114
    - 8.8.8.8
  nameserver-policy:
    "geosite:cn": 114.114.114.114
    "+.google.com": https://dns.cloudflare.com/dns-query

backcn-rules = |
  - RULE-SET,lan,DIRECT
  - IP-CIDR,192.168.0.0/16,DIRECT,no-resolve
  - IP-CIDR,10.0.0.0/8,DIRECT,no-resolve
  - IP-CIDR,172.16.0.0/12,DIRECT,no-resolve
  - RULE-SET,geoip-cn,BackCN-Group
  - RULE-SET,geoip-cn-v6,BackCN-Group
  - RULE-SET,geosite-cn,BackCN-Group
  - RULE-SET,alibaba,BackCN-Group
  - RULE-SET,jd,BackCN-Group
  - RULE-SET,alipay,BackCN-Group
  - RULE-SET,tencent,BackCN-Group
  - RULE-SET,bilibili,BackCN-Group
  - RULE-SET,douyin,BackCN-Group
  - RULE-SET,meituan,BackCN-Group
  - RULE-SET,didi,BackCN-Group
  - RULE-SET,baidu,BackCN-Group
  - DOMAIN-SUFFIX,baidu.com,BackCN-Group
  - DOMAIN-SUFFIX,qq.com,BackCN-Group
  - RULE-SET,gfw,Overseas-Group
  - DOMAIN-SUFFIX,google.com,Overseas-Group
  - DOMAIN-SUFFIX,youtube.com,Overseas-Group
  - RULE-SET,banad,REJECT
  - RULE-SET,adblock_reject,REJECT
  - MATCH,Overseas-Group

rule-providers = |
  lan: type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Lan.list", path: ./ruleset/lan.yaml, interval: 43200
  geoip-cn: type: http, behavior: classical, url: "https://raw.githubusercontent.com/Loyalsoldier/geoip/release/CN.txt", path: ./ruleset/geoip-cn.yaml, interval: 43200
  geoip-cn-v6: type: http, behavior: classical, url: "https://raw.githubusercontent.com/Loyalsoldier/geoip/release/CN_v6.txt", path: ./ruleset/geoip-cn-v6.yaml, interval: 43200
  geosite-cn: type: http, behavior: classical, url: "https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/geosite-cn.dat", path: ./ruleset/geosite-cn.yaml, interval: 43200
  alibaba: type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Alibaba.list", path: ./ruleset/alibaba.yaml, interval: 43200
  jd: type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/JD.list", path: ./ruleset/jd.yaml, interval: 43200
  alipay: type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Alipay.list", path: ./ruleset/alipay.yaml, interval: 43200
  tencent: type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Tencent.list", path: ./ruleset/tencent.yaml, interval: 43200
  banad: type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanAD.list", path: ./ruleset/banad.yaml, interval: 43200
  adblock_reject: type: http, behavior: domain, url: "https://raw.githubusercontent.com/REIJI007/AdBlock_Rule_For_Clash/main/adblock_reject.yaml", path: ./ruleset/adblock_reject.yaml, interval: 1200
  gfw: type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/GreatFire.list", path: ./ruleset/gfw.yaml, interval: 43200
