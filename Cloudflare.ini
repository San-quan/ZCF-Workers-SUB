; Cloudflare-Private-merged.ini
; 合并版：基于 San-quan/ZCF-Workers-SUB 的 Cloudflare.ini，加入 Subconverter / 私有化订阅模板支持
; 说明：
; - 该文件同时保留可直接用于 Clash/Clash.Meta 的 INI 段（示例节点、ProxyGroups、Rules 等）
; - 并加入 Subconverter 私有化 template 段（用于 Cloudflare Workers 后端生成 YAML/订阅）
; - 请替换示例节点信息 (server/port/password/uuid 等)，并根据需要设置环境变量或订阅 URL

; -------------------------
; Clash 原始 INI（直接可用）
; -------------------------
[General]
mixed-port = 7890
allow-lan = true
mode = rule
log-level = info
external-controller = 0.0.0.0:9090
secret =
ipv6 = true
unified-delay = true
tcp-concurrent = true
keep-alive-interval = 30

; -------------------------
; Proxies (示例节点 — 替换为真实节点)
; -------------------------
[Proxy:CN-1]
name = 🇨🇳回国节点1
type = ss
server = cn-server1.example.com
port = 443
cipher = chacha20-ietf-poly1305
password = your-cn-password
udp = true
ipv6 = true

[Proxy:CN-2]
name = 🇨🇳回国节点2
type = vmess
server = cn-server2.example.com
port = 443
uuid = your-cn-uuid
alterId = 0
cipher = auto
tls = true
udp = true
ipv6 = true

[Proxy:HK-1]
name = 🇭🇰香港节点1
type = trojan
server = hk-server1.example.com
port = 443
password = your-hk-password
sni = hk.example.com
udp = true
ipv6 = true

[Proxy:US-1]
name = 🇺🇸海外节点1
type = vmess
server = us-server1.example.com
port = 443
uuid = your-us-uuid
alterId = 0
cipher = auto
tls = true
udp = true
ipv6 = true

; -------------------------
; Proxy Groups
; -------------------------
[ProxyGroup:CN]
name = 🇨🇳回国组
type = url-test
proxies = 🇨🇳回国节点1,🇨🇳回国节点2
url = http://www.gstatic.com/generate_204
interval = 300
tolerance = 50

[ProxyGroup:HK]
name = 🇭🇰香港组
type = url-test
proxies = 🇭🇰香港节点1
url = http://www.gstatic.com/generate_204
interval = 300
tolerance = 50

[ProxyGroup:US]
name = 🇺🇸海外组
type = url-test
proxies = 🇺🇸海外节点1
url = http://www.gstatic.com/generate_204
interval = 300
tolerance = 50

[ProxyGroup:ReturnToCN]
name = 海外回国代理
type = select
proxies = 🇨🇳回国节点1,🇨🇳回国节点2,DIRECT

; -------------------------
; DNS 配置
; -------------------------
[DNS]
enable = true
ipv6 = true
enhanced-mode = fake-ip
fake-ip-range = 198.18.0.1/16
nameserver = 114.114.114.114,8.8.8.8
fallback = https://dns.cloudflare.com/dns-query,https://doh.360.cn/dns-query
nameserver-policy.geosite:cn = 114.114.114.114
nameserver-policy.+.google.com = https://dns.cloudflare.com/dns-query

; -------------------------
; Rules (原始静态规则)
; -------------------------
[Rules]
1 = GEOIP,CN,🇨🇳回国组
2 = DOMAIN-SUFFIX,cn,🇨🇳回国组
3 = DOMAIN-SUFFIX,baidu.com,🇨🇳回国组
4 = DOMAIN-SUFFIX,qq.com,🇨🇳回国组
5 = DOMAIN-SUFFIX,google.com,🇭🇰香港组
6 = DOMAIN-SUFFIX,youtube.com,🇭🇰香港组
7 = DOMAIN-SUFFIX,netflix.com,🇭🇰香港组
8 = DOMAIN-SUFFIX,facebook.com,🇺🇸海外组
9 = DOMAIN-SUFFIX,speedtest.net,🇨🇳回国组
10 = DOMAIN-SUFFIX,speedtest.cn,🇨🇳回国组
11 = DOMAIN-SUFFIX,ookla.com,🇨🇳回国组
12 = DOMAIN-KEYWORD,speedtest,🇨🇳回国组
13 = MATCH,🇺🇸海外组

; -------------------------
; Subconverter / 私有化模板段（用于 Cloudflare Workers / 后端生成订阅）
; 说明：Subconverter 风格字段，template 段输出最终 Clash YAML
; -------------------------
[general]
loglevel = info
append = false
skip-missed = true
tproxy = true
error-report = true
log-file = /tmp/subconverter.log

[rule_provider]
geoip-cn = type: http, behavior: classical, url: "https://raw.githubusercontent.com/Loyalsoldier/geoip/release/CN.txt", path: ./ruleset/geoip-cn.yaml, interval: 43200
geosite-cn = type: http, behavior: classical, url: "https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/geosite-cn.dat", path: ./ruleset/geosite-cn.yaml, interval: 43200
alibaba = type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Alibaba.list", path: ./ruleset/alibaba.yaml, interval: 43200
tencent = type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Tencent.list", path: ./ruleset/tencent.yaml, interval: 43200
baidu = type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Baidu.list", path: ./ruleset/baidu.yaml, interval: 43200
lan = type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Lan.list", path: ./ruleset/lan.yaml, interval: 43200
banad = type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanAD.list", path: ./ruleset/banad.yaml, interval: 43200
adblock_reject = type: http, behavior: domain, url: "https://raw.githubusercontent.com/REIJI007/AdBlock_Rule_For_Clash/main/adblock_reject.yaml", path: ./ruleset/adblock_reject.yaml, interval: 1200
gfw = type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/GreatFire.list", path: ./ruleset/gfw.yaml, interval: 43200
speedtest-china = type: http, behavior: domain, url: "https://kelee.one/Tool/Clash/Rule/SpeedtestChina.yaml", path: ./ruleset/speedtest-china.yaml, interval: 43200

[template]
; Clash YAML 头部（用于 Subconverter 输出）
clash-config = |
  mixed-port: 7890
  allow-lan: true
  mode: rule
  log-level: info
  external-controller: 0.0.0.0:9090
  secret: ""
  ipv6: true

; Proxy Providers（订阅 URL 可使用环境变量或传参填充）
proxy-providers = |
  china_subscription:
    type: http
    url: "${china_sub_url}"
    interval: 3600
    health-check:
      enable: true
      url: "http://www.gstatic.com/generate_204"
      interval: 300
  overseas_subscription:
    type: http
    url: "${overseas_sub_url}"
    interval: 3600
    health-check:
      enable: true
      url: "http://www.gstatic.com/generate_204"
      interval: 300

; 静态或占位 proxies，订阅会覆盖这些或并列显示（支持环境变量占位）
proxies = |
  - name: 🇨🇳回国节点
    type: ss
    server: ${CN_SERVER}
    port: ${CN_PORT}
    cipher: ${CN_ENCRYPTION}
    password: ${CN_PASSWORD}
    udp: true
    ipv6: true
  - name: 🇺🇸海外节点
    type: trojan
    server: ${US_SERVER}
    port: ${US_PORT}
    password: ${US_PASSWORD}
    sni: ${US_SNI}
    udp: true
    ipv6: true

; Proxy Groups（url-test 自动测速）
proxy-groups = |
  - name: 🇨🇳回国组
    type: url-test
    proxies:
      - china_subscription
      - 🇺🇸海外节点
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    tolerance: 50
  - name: 🇺🇸海外组
    type: url-test
    proxies:
      - overseas_subscription
      - 🇨🇳回国组
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    tolerance: 50

; DNS（防泄漏 + 分流）
dns = |
  enable: true
  ipv6: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  nameserver:
    - 114.114.114.114
  fallback:
    - https://dns.cloudflare.com/dns-query
  nameserver-policy:
    "geosite:cn": 114.114.114.114

; 路由规则（使用 RULE-SET 调用 rule-providers）
backcn-rules = |
  - RULE-SET,lan,DIRECT
  - RULE-SET,geoip-cn,🇨🇳回国组
  - RULE-SET,geosite-cn,🇨🇳回国组
  - RULE-SET,alibaba,🇨🇳回国组
  - RULE-SET,tencent,🇨🇳回国组
  - RULE-SET,baidu,🇨🇳回国组
  - RULE-SET,gfw,🇺🇸海外组
  - RULE-SET,banad,REJECT
  - RULE-SET,adblock_reject,REJECT
  - MATCH,🇺🇸海外组

; Subconverter 风格的 rule-providers 块（YAML 文本形式）
rule-providers = |
  lan: type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Lan.list", path: ./ruleset/lan.yaml, interval: 43200
  geoip-cn: type: http, behavior: classical, url: "https://raw.githubusercontent.com/Loyalsoldier/geoip/release/CN.txt", path: ./ruleset/geoip-cn.yaml, interval: 43200
  geosite-cn: type: http, behavior: classical, url: "https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/geosite-cn.dat", path: ./ruleset/geosite-cn.yaml, interval: 43200
  alibaba: type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Alibaba.list", path: ./ruleset/alibaba.yaml, interval: 43200
  tencent: type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Tencent.list", path: ./ruleset/tencent.yaml, interval: 43200
  baidu: type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Baidu.list", path: ./ruleset/baidu.yaml, interval: 43200
  banad: type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanAD.list", path: ./ruleset/banad.yaml, interval: 43200
  adblock_reject: type: http, behavior: domain, url: "https://raw.githubusercontent.com/REIJI007/AdBlock_Rule_For_Clash/main/adblock_reject.yaml", path: ./ruleset/adblock_reject.yaml, interval: 1200
  gfw: type: http, behavior: classical, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/GreatFire.list", path: ./ruleset/gfw.yaml, interval: 43200
  speedtest-china: type: http, behavior: domain, url: "https://kelee.one/Tool/Clash/Rule/SpeedtestChina.yaml", path: ./ruleset/speedtest-china.yaml, interval: 43200
